"use strict";(function(e){var t={Observe:function(e,i,s){if(e){var o=n.observer;o&&e.useObserver?o.observe(e.wrapper):t.Load(e,i,s,r.GetWidgetDef(e.key).conf)}},Load:function(e,t,n,i,s){i=i||r.GetWidgetDef(e.key),$(e.widget).pbAjax({success:function(t){s?s(e,t):r.RenderWidget(e,t),r.UpdateWidget(e),i.success&&i.success(e),e.events.loaded=!0,$.event.trigger("AjaxWidgetsLoaded:"+e.key,{widgetItem:e}),r.Log("Widget [{0}] loaded.".format(e.key))},beforeSend:function(t){e.events.loading?(r.Log("Widget [{0}] still loading".format(e.key)),t.abort()):e.events.loaded&&!n?(r.Log("Widget [{0}] already loaded".format(e.key)),t.abort()):(s||(e.wrapper.innerHTML=""),e.events.loading=!0)},error:function(t){r.Log("Error loading widget [{0}], cause: {1}".format(e.key,t.statusText)),i.error&&i.error(t)},complete:function(){e.events.loading=!1},url:"/pb/widgets/ajax/graphql/"+i.url,data:t})},Init:function(){function e(e){e.classList.add("hide-completely")}n.widgets.forEach(function(i){if(n.widgetDefs[i.key].active())t.Observe(i);else{var s=i.widget,o=s.closest(".tab-pane"),u=o&&o.id?document.querySelector('a[href$="'+o.id+'"]').parentElement:undefined;u&&(e(u),e(o)),e(s),r.Log("Widget [{0}] is not active, skipping".format(i.key))}}),$.event.trigger("AjaxWidgetsInit"),$.event.trigger("WidgetReinit.layout-tabs")}},n={registered:!1,observer:null,widgetDefs:{},widgets:[],conf:{url:"",active:function(){return!0},success:null,error:null},RegisterObserver:function(){r.Log("Registering Observer"),"IntersectionObserver"in window?(this.observer=new IntersectionObserver(function(e,n){e.forEach(function(e){if(e.isIntersecting){var i=e.target,s=r.GetWidgetItem(i);r.Log("loading [{0}] from IntersectionObserver.".format(s.key)),n.unobserve(i),t.Load(s)}})}),r.Log("Registering Observer is done")):r.Log("Registering Observer was unsuccessful, IntersectionObserver is unsupported on this browser")},Register:function(e){if(!document.body){r.Log("Calling register before document.body is fully loaded.");return}this.registered?r.Log("Register is called more than once."):(this.registered=!0,setTimeout(function(){n.RegisterObserver(),Object.keys(e).forEach(function(t){n.widgetDefs[t]=TandfUtils.extend(e[t],n.conf)}),r.CollectAjaxWidgets().forEach(function(e){var t=e.dataset.ajaxWidget;r.GetWidgetDef(t)?(n.widgets.push(r.GetMappedWidget(e)),r.Log("[{0}] is registered.".format(t))):r.Log("Widget definition not found for [{0}], add the definition to AjaxWidgets.Settings.Register.".format(t))}),t.Init()}))},Reset:function(){this.registered=!1,this.widgetDefs={},this.widgets=[]}},r={GetWidgetDef:function(e){return n.widgetDefs[e]},UpdateWidget:function(e){e.widget=document.getElementById(e.id),e.wrapper=e.widget.querySelector(".ajaxWidget")},RenderWidget:function(e,t){$(e.widget).replaceWith(t)},Log:function(e){console.debug("AjaxWidgets:: "+e)},GetMappedWidget:function(e){var t=e.closest(".widget"),n={id:t.id,key:e.dataset.ajaxWidget,useObserver:e.dataset.ajaxObserve,widget:t,wrapper:e,events:{loaded:!1}},r=!1;return Object.defineProperty(n.events,"loading",{get:function(){return r},set:function(t){r=t;var i=n.wrapper.classList,s="loading"+(e.dataset.ajaxSpin==="true"&&!n.events.loaded?"-spinner":"");r?i.add(s):i.remove(s)}}),n},GetWidgetItem:function(e){var t=e.dataset;return n.widgets.find(function(e){return e.id===t.ajaxWidgetId})},CollectAjaxWidgets:function(){return document.querySelectorAll(".ajaxWidget[data-ajax-widget]")}};e.AjaxWidgets=t,e.AjaxWidgets.Settings=n})(tandf);(function(e){$(function(){var t=e.AjaxWidgets;t&&(console.debug("Attaching AjaxWidgets event listeners"),$(document).on(["ajaxMostReadWidget","ajaxMostRecentWidget","ajaxMostCitedWidget","ajaxOpenAccessWidget","ajaxAtmCRWidget","ajaxCFCRWidget","ajaxCitedByWidget","ajaxAltmetricTopCitedArticlesWidget","gql-publication-list"].map(function(e){return"AjaxWidgetsLoaded:"+e}).join(" "),function(e,n){n=n.widgetItem;if(!n.wrapper.innerText){n.widget.classList.add("hide-completely");return}n.widget.closest(".collapsed-view")||cardsContainer(n.widget),n.widget.querySelector(".paginationLinkContainer")&&n.widget.querySelectorAll("a[data-start-page]").forEach(function(e){e.addEventListener("click",function(r){r.preventDefault(),t.Load(n,{startPage:e.dataset.startPage},!0)})}),document.dispatchEvent(new CustomEvent("attach-behaviour"))}),$(document).on("AjaxWidgetsLoaded:literatumArticleMetricsWidget AjaxWidgetsLoaded:ajaxMostRecentWidget AjaxWidgetsLoaded:ajaxMostReadWidget AjaxWidgetsLoaded:ajaxMostCitedWidget AjaxWidgetsLoaded:ajaxOpenAccessWidget AjaxWidgetsLoaded:ajaxAtmCRWidget AjaxWidgetsLoaded:ajaxCFCRWidget AjaxWidgetsLoaded:ajaxCitedByWidget AjaxWidgetsLoaded:ajaxAltmetricTopCitedArticlesWidget AjaxWidgetsLoaded:gql-publication-list",function(t,n){function s(e){var t=r.Settings.observer;i.querySelectorAll(e).forEach(function(e){t?t.observe(e):r.Helpers.load(e)})}var r=e.Altmetric;if(r){var i=n.widgetItem.widget;i.querySelector(".compactView")?s(".altmetric-score .value"):i.querySelector(".metrics-badge")&&s(".metrics-badge")}}),$(document).on("AjaxWidgetsInit",function(){selectFirstTabEle()}),$(document).on("AjaxWidgetsLoaded:ajaxCFCRWidget",function(e,n){e.preventDefault(),n=n.widgetItem;var r=n.widget.querySelector(".collapsed-view--view-more");r&&(r.onclick=function(){return n.moreLoaded?$(n.widget).find(".more").toggleClass("hide-completely"):t.Load(n,{viewMore:"true"},!0,null,function(e,t){$(n.widget).find(".article-card:first-child").parent().append($(t).find(".article-card").addClass("more")),n.moreLoaded=!0}),$(r).text($(r).text()==="View more"?"View fewer":"View more"),!1})})),$(document).on("altmetric:show",function(e){var t=e.target;if(!t.hasAttribute("data-score")){var n=t.parentElement.querySelector(".score .metrics-score");if(n){var r=Object.values(_altmetric.badges[t.dataset.doi])[0].score||0;n.innerText=r,t.setAttribute("data-score",r)}}})})})(tandf);tandf.AjaxWidgets.Settings.Register({ajaxOpenAccessWidget:{url:"topContentView/ajaxOpenAccessController"},ajaxMostCitedWidget:{url:"topContentView/ajaxMostCitedController"},ajaxMostRecentWidget:{url:"topContentView/ajaxMostRecentController"},ajaxMostReadWidget:{url:"topContentView/ajaxMostReadController"},ajaxAtmCRWidget:{url:"topContentView/ajaxAtmCRController"},ajaxCFCRWidget:{url:"ajaxCFCRController",active:function(){return tandfData.search.cbRec>0}},"gql-content-navigation":{active:function(){return!tandfData.identity.isSpv}},literatumArticleMetricsWidget:{url:"altmetric"},ajaxCitedByWidget:{url:"ajaxCitedByController"},specialIssuesWidget:{url:"topContentView/specialIssuesController"},ajaxAltmetricTopCitedArticlesWidget:{url:"ajaxAltmetricTopCitedArticlesController"},"gql-publication-list":{url:"pubList"}});